<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>メルクストーリア 祈り計算機</title>
<meta content='width=device-width; initial-scale=1; user-scalable=0' name='viewport'>
<meta content='yes' name='apple-mobile-web-app-capable'>
<meta content='black' name='apple-mobile-web-app-status-bar-style'>

<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css" />
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
<style type="text/css">
div.container {
  margin: 0.5em;
}
#seed-hp {
  width: 7em;
}
.ui-slider-track {
  margin-left: 9em;
}
.result-body {
  text-align: center;
}
#pray-result {
  font-size: 6em;
}
div.notice {
  padding: 0.8em 0px;
}
ul, ol {
  margin-right: 1em;
}
ul.notice > li {
  list-style-type: none;
}
ul.notice > li:before {
  content: "※";
  margin-left: -1em;
}
</style>
<script type="text/javascript">
$(function() {
  var seed_table = [
    { hp: 160000, name: 'ワイバーン' },
    { hp: 150000, name: 'アースドラゴン' },
    { hp: 147000, name: 'ニグレット' },
    { hp: 144000, name: 'グラニアゼウス' },
    { hp: 137000, name: 'ジャバウォック' },
    { hp: 135000, name: 'シックル' },
    { hp: 127000, name: 'ファーブニール' },
    { hp: 123000, name: 'ノーズハンマー' },
    { hp: 120000, name: 'メッゾドラニカ' },
    { hp: 111000, name: 'クロウヴィス' },
    { hp:  94000, name: 'ユニルス' },
  ];

  for (var i in seed_table) {
    $('#seed').append('<option value="' + i + '">' + seed_table[i].name + '</option>');
  }
  $('#seed').val("0").selectmenu('refresh');

  $.getQuery = function (name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
  }

  var maxpray = Number($.getQuery('maxpray')) || 300;

  var reset_hp = function() {
    var seed, wave, oldval, min, max;
    seed = seed_table[$('#seed').val()];
    wave = $('input[name="wave"]:checked').val();
    oldval = $('#seed-hp').val();
    min = seed.hp * (1 + (wave - 1)*0.2)
    max = min*(maxpray + 100)/100;

    $('#seed-hp')
      .attr('min', min)
      .attr('max', max)
      .attr('step', min/100)
      .val(Math.min(Math.max(oldval, min), max))
      .slider('refresh');
  };
  $('input[name="wave"]').on('click', reset_hp);
  $('#seed').on('change', reset_hp);

  var calc = function() {
    var seed, hp, obshp, wave, result;
    seed = seed_table[$('#seed').val()];
    obshp = $('#seed-hp').val();
    wave = $('input[name="wave"]:checked').val();

    hp = seed.hp * (1 + (wave - 1)*0.2)
    result = Math.max(Math.round((obshp/hp)*100) - 100, 0);
    $("#pray-result").text(result);
  };

  $('input[name="wave"]').on('tap', calc);
  $('#seed').on('change', calc);
  $('#seed-hp').on('change', calc);

  $('[data-step-hp]').on('tap', function() {
    var step, ohp;
    step = ($('#seed-hp').attr('min')*$(this).data('step-hp'))/100;
    ohp  = $('#seed-hp').val();
    $('#seed-hp').val(Number(ohp) + step).slider('refresh');
  });

  reset_hp();
});
</script>
</head>
<body>
<div class="container">
  <h1>メルクストーリア 祈り計算機</h1>
  <form class="form-horizontal" role="form">
    <div data-role="fieldcontain">
      <label>シード出現 Wave</label>
      <fieldset data-role="controlgroup" data-type="horizontal">
        <label><input type="radio" name="wave" id="wave1" value="1" checked>1</label>
        <label><input type="radio" name="wave" id="wave2" value="2">2</label>
        <label><input type="radio" name="wave" id="wave3" value="3">3</label>
        <label><input type="radio" name="wave" id="wave4" value="4">4</label>
        <label><input type="radio" name="wave" id="wave5" value="5">5</label>
      </fieldset>
    </div>
    <div data-role="fieldcontain">
      <label for="seed">シードの種類</label>
      <select name="seed" id="seed">
      </select>
    </div>
    <div data-role="fieldcontain">
        <label style="height: 1.5em;">シードの最大体力</label>
        <input type="range" name="seed-hp" id="seed-hp" value="100000" min="100000" max="1000000" data-highlight="true">
        <div style="text-align: center;">
          <button type="button" data-step-hp="-10" data-role="button" data-icon="arrow-l" data-inline="true" data-mini="true" data-iconpos="notext">-10%</button>
          <button type="button" data-step-hp="-1" data-role="button" data-icon="minus" data-inline="true" data-mini="true" data-iconpos="notext">-1%</button>
          <button type="button" data-step-hp="1" data-role="button" data-icon="plus" data-inline="true" data-mini="true" data-iconpos="notext">+1%</button>
          <button type="button" data-step-hp="10" data-role="button" data-icon="arrow-r" data-inline="true" data-mini="true" data-iconpos="notext">+10%</button>
        </div>
    </div>
    <div data-role="fieldcontain">
      <label>予想祈り</label>
      <p class="result-body">約<span id="pray-result">0</span>%</p>
    </div>
    <div class="notice">
      <label>概要</label>
      <p><a href="http://mercstoria.happyelements.co.jp/">メルクストーリア</a>のギルドバトルにおいて、相手ギルドの「祈り」による防衛力上昇値を予想します。</p>
    </div>
    <div class="notice">
      <label>使い方</label>
      <ol class="usage">
        <li>ギルドバトルで相手ギルドのアジトに出撃します。</li>
        <li>ワイバーン、アースドラゴンなど、本ページで対応しているシードモンスターに出会ったときに、出現 Wave 数(何匹目か)と該当モンスターの最大体力を記憶します。</li>
        <li>本ページで、出現 Wave 数と該当シードモンスターの種類をそれぞれ選択します。</li>
        <li>「シードの最大体力」欄のスライダーを調整し、左側の数値が実際に出会ったシードの最大体力値と近い値になるようにします。</li>
        <li>「予想祈り」欄に表示される数値が、相手ギルドの祈りによる予想防衛値です。</li>
      </ol>
    </div>
    <div>
      <label>注意事項</label>
      <ul class="notice">
        <li>あくまで計算による予想値であって、正確な値ではありません。</li>
        <li>基準となるシードモンスターの最大体力は、<a href="http://メルクストーリア.gamerch.com/">メルクストーリア - 癒術士と鈴のしらべ -攻略Wiki【メルスト攻略】</a>の該当ページに記載されているサイズ 1.7 の値を用いています。</li>
        <li>標準ではシードの体力選択スライダーは祈り 300% 相当が最大となっています。これを超える上位ギルドの方は下記をお試しください。
          <div data-role="controlgroup">
            <a href="?" data-ajax="false" data-role="button">祈り最大 300% (標準)</a>
            <a href="?maxpray=600" data-ajax="false" data-role="button">祈り最大 600%</a>
            <a href="?maxpray=1200" data-ajax="false" data-role="button">祈り最大 1200%</a>
            <a href="?maxpray=2400" data-ajax="false" data-role="button">祈り最大 2400%</a>
            <a href="?maxpray=3600" data-ajax="false" data-role="button">祈り最大 3600%</a>
            <a href="?maxpray=4800" data-ajax="false" data-role="button">祈り最大 4800%</a>
            <a href="?maxpray=6000" data-ajax="false" data-role="button">祈り最大 6000%</a>
            <a href="?maxpray=9000" data-ajax="false" data-role="button">祈り最大 9000%</a>
            <a href="?maxpray=12000" data-ajax="false" data-role="button">祈り最大 12000%</a>
          </div>
        </li>
      </ul>
    </div>
  </form>
</div>
</body>
</html>
